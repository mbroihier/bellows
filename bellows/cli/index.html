<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script>
      window.onload = function(){
	  let socket = new WebSocket("ws://192.168.1.224:8126");
	  var wsexists = false;
	  socket.onopen = function(e) {
	      console.log("ws connection made");
	      socket.send("{ connected: true }");
	      wsexists = true;
	  };
	  socket.onmessage = function(event) {
	      let statusObject = JSON.parse(event.data);
	      console.log(statusObject)
	      for (device in statusObject) {
		  console.log("working with " + device);
		  if (statusObject[device] == 'on') {
		      console.log("device is " + statusObject[device])
		      document.getElementById(device+'off').setAttribute('style', 'visibility: visible');
		      document.getElementById(device+'on').setAttribute('style', 'visibility: hidden');
		  } else if (statusObject[device] == 'off') {
		      console.log("device is " + statusObject[device])
		      document.getElementById(device+'on').setAttribute('style', 'visibility: visible');
		      document.getElementById(device+'off').setAttribute('style', 'visibility: hidden');
		  } else if (statusObject[device] == 'unknown') {
		      console.log("device is " + statusObject[device])
		      document.getElementById(device+'on').setAttribute('style', 'visibility: visible');
		      document.getElementById(device+'off').setAttribute('style', 'visibility: visible');
		  } else {
		      document.getElementById(device+'on').setAttribute('style', 'visibility: visible');
		      document.getElementById(device+'off').setAttribute('style', 'visibility: visible');
		  }
	      }
	  }
	  socket.onclose = function(e) {
	      console.log("didn't expect close");
	      if (!wsexists) {
		  statusObject = {"34:10:f4:ff:fe:2f:3f:b6" : true, "b0:c7:de:ff:fe:52:ca:58" : true};
		  for (device in statusObject) {
		      console.log("setting up for no websocket server " + device);
		      document.getElementById(device+'off').setAttribute('style', 'visibility: visible');
		      document.getElementById(device+'on').setAttribute('style', 'visibility: visible');
		  }
	      }
	  }
      }
      </script>
    <title> Light Controller </title>
  </head>
  <body>
    <style>
      div {
	  width: 100%;
	  height: 300px;
	  text-align: center;
      }
      ul {
	  list-style-type: none;
      }
      button {
	  width: 35%;
	  padding: 4px 4px;
	  border: 3px solid black;
	  margin: 2px 2px;
	  font-size: 50px;
	  border-radius: 10px;
      }
    </style>
    <h1> Switches </h1>
    <ul>
      <div>
      <form>
      <li><button id="34:10:f4:ff:fe:2f:3f:b6on" style="visibility: hidden" type="submit" formaction="/34:10:f4:ff:fe:2f:3f:b6on" formmethod="get">bedroom on</button></li>
      <li><button id="34:10:f4:ff:fe:2f:3f:b6off" style="visibility: hidden" type="submit" formaction="/34:10:f4:ff:fe:2f:3f:b6off" formmethod="get">bedroom off</button></li>
      <li><button id="b0:c7:de:ff:fe:52:ca:58on" style="visibility: hidden" type="submit" formaction="/b0:c7:de:ff:fe:52:ca:58on" formmethod="get"> office on </button></li>
      <li><button id="b0:c7:de:ff:fe:52:ca:58off" style="visibility: hidden" type="submit" formaction="/b0:c7:de:ff:fe:52:ca:58off" formmethod="get"> office off </button></li>
      </form>
      </div>
    </ul>
  </body>
</html>
